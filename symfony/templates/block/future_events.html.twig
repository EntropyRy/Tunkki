{% extends sonata_block.templates.block_base %}
{% block block %}
    {% if settings.box|default(false) %}
        <div class="box">
            <div class="box-header">
                <div class="h5">{{ 'block.events.upcoming_events'|trans }}</div>
            </div>
            <div class="box-body">
            {% else %}
                <div class="col">
                    <div class="h5 text-center text-sm-start">{{ 'block.events.future_events'|trans }}</div>
    {% endif %}
        <ul class="fa-ul">
            {% for event in events %}
                {{ block('event_link') }}
            {% else %}
                <li>
                    <span class="fa-li">
                        <twig:ux:icon name="exclamation" />
                    </span> {{ 'stay_tuned'|trans }}
                </li>
                <li>
                    <span class="fa-li">
                        <twig:ux:icon name="arrow-right" />
                    </span> {{ 'block.future_events.checkout_old_events'|trans }} <a href="{{ app.request.locale == 'fi' ? '/tapahtumat' : '/events' }}">{{ 'block.future_events.events'|trans }}</a>
                </li>
            {% endfor %}
            {% if app.user and unreleased|length > 0 %}
                <li>{{ 'event.only_for_members'|trans }}</li>
                {% for event in unreleased %}{{ block('event_link') }}{% endfor %}
            {% endif %}
        </ul>
        {% if settings.box|default(false) %}
            {% if is_granted('ROLE_ADMIN_EVENT_EDIT') or is_granted('ROLE_SUPER_ADMIN') %}
                <a class="btn btn-primary" href="{{ path('admin_app_event_list') }}">{{ 'block.events.manage'|trans }}</a>
            {% endif %}
            <a class="btn btn-primary"
                href="{{ path('entropy_event_calendar_config') }}">{{ 'calendar.heading'|trans }}</a>
            </div>
        </div>
        {% else %}
        </div>
    {% endif %}
{% endblock %}
{% block event_link %}
    {% if event.externalUrl or (event.url and event.url starts with 'http') %}
        {% set url = event.url %}
    {% elseif event.url %}
        {% set url = path('entropy_event_slug.' ~ app.request.locale, {slug: event.url, year: event.eventdate|date('Y')}) %}
    {% else %}
        {% set url = path('entropy_event.' ~ app.request.locale, {id: event.id}) %}
    {% endif %}
    <li>
        <span class="fa-li"><twig:ux:icon name="link" /></span>
        <a href="{{ url }}">
            <span {% if event.cancelled %}style="text-decoration: line-through;"{% endif %}>
                {{ event.nameByLang(app.request.locale) }} - {{ event.eventDate|date() }}
            </span>
        </a>
        {% if event.cancelled %}
            <span class="badge text-bg-danger ms-1">{{ 'cancelled'|trans }}</span>
        {% endif %}
    </li>
{% endblock %}
