{% extends event.template %}
{% use 'pieces/event.html.twig' %}
{% use 'pieces/nakkikone.html.twig' %}
{% block content %}
    {% if event.nakkikone and event.nakkikone.requiresDifferentTimes == false %}
        {% set hide_time = true %}
    {% endif %}
    {% set l = app.request.locale %}
    <div class="col-12" {{ stimulus_controller('nakkikone') }}>
        <h1 class="event-heading">
            <a href="{{ block('event_path') }}">{{ block('event_name') }}</a>
            — {{ 'event.section.nakkikone'|trans }}
        </h1>
        <p class="text-muted">
            {{ 'event.section.event_time'|trans }}:
            {{ event.eventdate|date('d.m.Y, H:i') }}
            {% if event.until %}– {{ event.until|date('d.m.Y, H:i') }}{% endif %}
        </p>
        {{ block('your_nakkis') }}
        {% set nakki_info = event.nakkikone ? event.nakkikone.getInfoByLocale(l) : null %}
        {% if nakki_info %}
            {{ nakki_info|markdown_to_html|raw }}
        {% endif %}
        <hr>
        <h3>{{ 'Select Nakki'|trans }}</h3>
        <div class="row">
            <div class="col-sm-6 col-md-4">
                <div class="list-group" id="list-tab" role="tablist">
                    {% for name, nakki in nakkis %}
                        {% if not event.multiday and (compared is not defined or compared != nakki.compared_to_event) %}
                            <h5 class="mt-2">{{ nakki.compared_to_event|trans }}</h5>
                        {% endif %}
                        <a class="list-group-item list-group-item-action"
                           id="list-{{ name }}-list"
                           data-bs-toggle="list"
                           data-index="{{ loop.index }}"
                           href="#nakki{{ loop.index }}"
                           role="tab"
                           aria-controls="{{ name }}">
                            {{ name }}
                            {% if event.nakkikone and event.nakkikone.requiresDifferentTimes == false and not event.multiday %}
                                ({{ nakki.durations|join('h, ') }}h)
                            {% endif %}
                            <span class="badge bg-secondary rounded-pill float-end">{{ nakki.not_reserved|default(0) }}</span>
                        </a>
                        {% set compared = nakki.compared_to_event %}
                    {% endfor %}
                </div>
            </div>
            <div class="col-sm-6 col-md-8">
                <div class="tab-content"
                     id="nav-tabContent">
                    <div class="tab-pane fade active show "
                         id="list-none"
                         role="tabpanel"
                         aria-labelledby="list-none">
                        <h3>
                            {# { 'Nakki descriptions'|trans } #}
                            <small>{{ 'Choose a shift ("Nakki") to see the description'|trans }}.</small>
                        </h3>
                    </div>
                    {% for name, nakki in nakkis %}
                        <div class="tab-pane fade"
                             id="nakki{{ loop.index }}"
                             role="tabpanel"
                             aria-labelledby="list-{{ name }}-list">
                            <p>{{ nakki['description']|markdown_to_html|raw }}</p>
                            {% if event.nakkikone and event.nakkikone.requiresDifferentTimes == false and event.multiday %}
                                <p>{{ 'Responsible'|trans }}: {{ nakki.responsible|default('') }}</p>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    <div class="col-12 mt-3 d-none show-on-click">
        <h3>{{ 'Reserve your Nakki'|trans }}</h3>
        {{ block('reserve_nakkis') }}
    </div>
{% endblock %}
